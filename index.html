<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Orbit Simulation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: black;
            color: white;
        }
        canvas {
            display: block;
        }
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        .control-label {
            margin-bottom: 5px;
            display: block;
        }
        input, button {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="controls">
        <label for="initialDirectionX" class="control-label">Initial X Direction:</label>
        <input type="number" id="initialDirectionX" value="1" class="control-input">
        
        <label for="initialDirectionY" class="control-label">Initial Y Direction:</label>
        <input type="number" id="initialDirectionY" value="0" class="control-input">
        
        <label for="initialPosX" class="control-label">Initial X Position (meters):</label>
        <input type="number" id="initialPosX" value="384400000" class="control-input">
        
        <label for="initialPosY" class="control-label">Initial Y Position (meters):</label>
        <input type="number" id="initialPosY" value="0" class="control-input">
        
        <label for="initialVelocity" class="control-label">Initial Velocity (m/s):</label>
        <input type="number" id="initialVelocity" value="1023.056" class="control-input">
        
        <button onclick="startSimulation()">Start Simulation</button>
        <button onclick="downloadCSV()">Download CSV</button>
    </div>

    <script>
        const G = 6.67430e-11;    // Gravitational constant (m^3 kg^-1 s^-2)
        const earthMass = 5.9722e24; // Earth's mass (kg)
        const earthRadius = 6371e3;  // Earth's radius in meters
        const moonRadius = 1737e3;   // Moon's radius in meters
        let timeStep = 10;         // Time step for simulation (in seconds)
        let timeFrame = 10000000;   // Simulation time frame
        let trajectoryData = [];   // Store trajectory data for CSV
        let velocities = [];       // Store velocity data
        let positions = [];        // Store position data

        // Unit vector calculation (normalization)
        function normalizeVector(x, y) {
            let magnitude = Math.sqrt(x * x + y * y);
            return { x: x / magnitude, y: y / magnitude };
        }

        // Gravitational acceleration calculation
        function calculateAcceleration(x, y, distance) {
            let force = -G * earthMass / Math.pow(distance, 3);
            return { x: force * x, y: force * y };
        }

        // Verlet Position Update
        function verletPosition(pos, vel, accel, dt) {
            let newPos = {
                x: pos.x + vel.x * dt + 0.5 * accel.x * Math.pow(dt, 2),
                y: pos.y + vel.y * dt + 0.5 * accel.y * Math.pow(dt, 2),
            };
            return newPos;
        }

        // Verlet Velocity Update
        function verletVelocity(vel, accel, prevAccel, dt) {
            let newVel = {
                x: vel.x + 0.5 * (accel.x + prevAccel.x) * dt,
                y: vel.y + 0.5 * (accel.y + prevAccel.y) * dt,
            };
            return newVel;
        }

        function startSimulation() {
            // Get user input values
            let initialDirectionX = parseFloat(document.getElementById('initialDirectionX').value);
            let initialDirectionY = parseFloat(document.getElementById('initialDirectionY').value);
            let initialPosX = parseFloat(document.getElementById('initialPosX').value);
            let initialPosY = parseFloat(document.getElementById('initialPosY').value);
            let initialVelocity = parseFloat(document.getElementById('initialVelocity').value);

            // Normalize the initial direction
            let unitDirection = normalizeVector(initialDirectionX, initialDirectionY);

            // Initial position and velocity vectors (scaled by velocity)
            let initialPosition = { x: initialPosX, y: initialPosY };
            let initialVelocityVector = { x: unitDirection.x * initialVelocity, y: unitDirection.y * initialVelocity };

            // Calculate initial acceleration
            let distance = Math.sqrt(initialPosX * initialPosX + initialPosY * initialPosY);
            let initialAccel = calculateAcceleration(initialPosX, initialPosY, distance);

            // Initial values for simulation
            let velocity = initialVelocityVector;
            let position = initialPosition;
            let accel = initialAccel;

            // Clear previous trajectory data
            trajectoryData = [];
            velocities = [];
            positions = [];

            // Store initial values
            positions.push(position);
            velocities.push(velocity);
            trajectoryData.push([position.x, position.y]);

            // Run the simulation
            for (let i = 1; i < timeFrame; i++) {
                // Update position and velocity
                let newPosition = verletPosition(position, velocity, accel, timeStep);
                let newDistance = Math.sqrt(newPosition.x * newPosition.x + newPosition.y * newPosition.y);

                // Check for collision with Earth
                if (newDistance <= earthRadius + moonRadius) {
                    console.log("Collision detected at:", newPosition);
                    break;
                }

                // Update acceleration and velocity
                let newAccel = calculateAcceleration(newPosition.x, newPosition.y, newDistance);
                let newVelocity = verletVelocity(velocity, newAccel, accel, timeStep);

                // Store the new values
                position = newPosition;
                velocity = newVelocity;
                accel = newAccel;

                positions.push(position);
                velocities.push(velocity);
                trajectoryData.push([position.x, position.y]);
            }

            // Redraw the canvas and plot the trajectory
            drawTrajectory();
        }

        function drawTrajectory() {
            // Clear previous frame
            clear();
            background(0);

            const scale = 0.005;  // Scale factor to adjust positions
            const canvasCenterX = width / 2;
            const canvasCenterY = height / 2;

            // Draw Earth (blue circle)
            fill(0, 0, 255);
            ellipse(canvasCenterX, canvasCenterY, earthRadius * 2 * scale, earthRadius * 2 * scale);

            // Draw the Moon's trajectory (red dots)
            fill(255, 0, 0);
            for (let i = 0; i < trajectoryData.length; i++) {
                let x = trajectoryData[i][0];
                let y = trajectoryData[i][1];
                ellipse(x * scale + canvasCenterX, y * scale + canvasCenterY, 50, 50);
            }
        }

        function downloadCSV() {
            // Create a CSV string from the trajectory data
            let csvContent = "x, y\n";
            trajectoryData.forEach(function (row) {
                csvContent += row.join(", ") + "\n";
            });

            // Create a Blob for the CSV file
            let blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
            let link = document.createElement("a");
            if (link.download !== undefined) {
                // Create a downloadable link
                let url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", "moon_trajectory.csv");
                link.click();
            }
        }

        // Initialize p5.js canvas and drawing
        function setup() {
            createCanvas(windowWidth, windowHeight);
        }
        
        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>




