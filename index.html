<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moon Orbit Simulation</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background: black;
            color: white;
        }
        #plot {
            width: 100%;
            height: 100vh;
        }
        .controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 10;
            background-color: rgba(0, 0, 0, 0.5);
            padding: 10px;
            border-radius: 5px;
        }
        .control-label {
            margin-bottom: 5px;
            display: block;
        }
        input, button {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>

    <div class="controls">
        <button onclick="startSimulation()">Start Simulation</button>
    </div>

    <div id="plot"></div>

    <script>
        const G = 6.67430e-11; // Gravitational constant (m^3 kg^-1 s^-2)
        const earthMass = 5.9722e24; // Earth's mass (kg)
        const earthRadius = 6371e3; // Earth's radius (meters)
        const moonRadius = 1737e3; // Moon's radius (meters)
        const moonDistance = 384400000; // Moon's average distance from Earth (meters)

        const timeStep = 10; // Time step for simulation (in seconds)
        const totalTime = 10000000; // Total simulation time (in seconds)
        let xValues = [];
        let yValues = [];

        // Initial conditions (position, velocity, direction)
        const initialPosX = 384400000; // Initial X position (meters)
        const initialPosY = 0; // Initial Y position (meters)
        const initialVelocity = 1023.056; // Initial velocity (m/s)
        const initialDirectionX = 1; // Initial X direction (normalized)
        const initialDirectionY = 0; // Initial Y direction (normalized)

        // Normalize the initial direction
        function normalizeVector(x, y) {
            const magnitude = Math.sqrt(x * x + y * y);
            return { x: x / magnitude, y: y / magnitude };
        }

        // Gravitational acceleration
        function calculateAcceleration(x, y, distance) {
            const force = -G * earthMass / Math.pow(distance, 3);
            return { x: force * x, y: force * y };
        }

        // Verlet Position Update
        function verletPosition(pos, vel, accel, dt) {
            return {
                x: pos.x + vel.x * dt + 0.5 * accel.x * Math.pow(dt, 2),
                y: pos.y + vel.y * dt + 0.5 * accel.y * Math.pow(dt, 2)
            };
        }

        // Verlet Velocity Update
        function verletVelocity(vel, accel, prevAccel, dt) {
            return {
                x: vel.x + 0.5 * (accel.x + prevAccel.x) * dt,
                y: vel.y + 0.5 * (accel.y + prevAccel.y) * dt
            };
        }

        // Simulate the trajectory of the Moon
        function simulateTrajectory() {
            let position = { x: initialPosX, y: initialPosY };
            let velocity = { x: initialDirectionX * initialVelocity, y: initialDirectionY * initialVelocity };
            let accel = calculateAcceleration(position.x, position.y, moonDistance);
            let prevAccel = accel;

            // Store initial position
            xValues.push(position.x / 1000); // Convert to kilometers
            yValues.push(position.y / 1000); // Convert to kilometers

            // Simulate motion over time
            for (let i = 1; i < totalTime; i++) {
                // Update position and velocity
                let newPosition = verletPosition(position, velocity, accel, timeStep);
                let newDistance = Math.sqrt(newPosition.x * newPosition.x + newPosition.y * newPosition.y);

                // Check if the moon collides with Earth (very basic check)
                if (newDistance <= earthRadius + moonRadius) {
                    console.log("Collision detected at:", newPosition);
                    break;
                }

                // Update acceleration and velocity
                let newAccel = calculateAcceleration(newPosition.x, newPosition.y, newDistance);
                let newVelocity = verletVelocity(velocity, newAccel, prevAccel, timeStep);

                // Store the new values
                position = newPosition;
                velocity = newVelocity;
                accel = newAccel;

                xValues.push(position.x / 1000); // Convert to kilometers
                yValues.push(position.y / 1000); // Convert to kilometers
            }
        }

        // Start the simulation
        function startSimulation() {
            simulateTrajectory();

            // Diameter of Earth in kilometers and Moon's distance
            const earthDiameter = (2 * 6378137) / 1000; // Earth's diameter in km
            const earthMarkerSize = (earthDiameter / moonDistance) * 100000; // Scale factor

            // Plotly data structure
            const trace1 = {
                x: [0],  // Earth at the origin (0,0)
                y: [0],
                mode: 'markers',
                type: 'scatter',
                marker: { color: 'green', size: earthMarkerSize },
                name: 'Earth (scaled)',
            };

            const trace2 = {
                x: xValues,
                y: yValues,
                mode: 'lines+markers',
                type: 'scatter',
                marker: { color: 'white', size: 5 },
                name: 'Moon Trajectory',
            };

            // Layout settings
            const layout = {
                title: 'Moon Trajectory Over Time',
                xaxis: {
                    title: 'X (km)',
                    showgrid: true,
                    zeroline: true,
                },
                yaxis: {
                    title: 'Y (km)',
                    showgrid: true,
                    zeroline: true,
                },
                plot_bgcolor: 'black',
                paper_bgcolor: 'black',
                showlegend: true,
                font: { color: 'white' },
            };

            // Combine traces into a data array
            const data = [trace1, trace2];

            // Plot the data
            Plotly.newPlot('plot', data, layout).then(function(gd) {
                // Animation setup
                let frameIndex = 0;
                const interval = setInterval(function() {
                    if (frameIndex < xValues.length) {
                        Plotly.update(gd, {
                            x: [[xValues[frameIndex]]],
                            y: [[yValues[frameIndex]]],
                        }, {}, [1]);  // Update only the moon trajectory trace
                        frameIndex++;
                    } else {
                        clearInterval(interval);  // Stop animation when done
                    }
                }, 50);  // Update every 50 ms (you can adjust the speed)
            });
        }
    </script>

</body>
</html>





